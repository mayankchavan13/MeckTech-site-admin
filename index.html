<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MeckTech Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <style>
    body {
      background: #0d1117;
      color: #f0f6fc;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, select {
      background: #161b22;
      border: 1px solid #30363d;
      color: white;
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
    }
    button {
      background: #238636;
      color: white;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #30363d;
    }
    .question {
      background: #161b22;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .actions {
      display: flex;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è MeckTech Admin Panel</h1>

  <div class="section">
    <h2>üîß Branding</h2>
    <input type="text" id="companyName" placeholder="Enter Company Name" />
    <label>Upload Logo Image:</label>
    <input type="file" id="logoFile" accept="image/*" />
    <button onclick="saveBranding()">Save Branding</button>
  </div>

  <div class="section">
    <h2>üí∞ Set Price (with Discount)</h2>
    <input type="number" id="originalPrice" placeholder="Original Price (e.g. 249)" />
    <input type="number" id="discountPrice" placeholder="Discounted Price (e.g. 149)" />
    <button onclick="setPrice()">Save Price</button>
  </div>

  <div class="section">
    <h2>üìö Add Question</h2>
    <input type="text" id="questionText" placeholder="Enter question text" />
    <input type="text" id="opt1" placeholder="Option 1" />
    <input type="text" id="opt2" placeholder="Option 2" />
    <input type="text" id="opt3" placeholder="Option 3" />
    <input type="text" id="opt4" placeholder="Option 4" />
    <select id="correctOption">
      <option value="">Select Correct Option</option>
      <option value="0">Option 1</option>
      <option value="1">Option 2</option>
      <option value="2">Option 3</option>
      <option value="3">Option 4</option>
    </select>
    <button onclick="addQuestion()">Add Question</button>
  </div>

  <div class="section">
    <h2>üìã All Questions</h2>
    <div id="questionsList">Loading...</div>
  </div>

  <div class="section">
    <h2>‚úÖ Paid Users</h2>
    <div id="paidUsersList">Loading...</div>
  </div>

  <footer style="margin-top: 40px; text-align: center; font-size: 14px; color: gray;">
    Contact us: <a href="mailto:royalmanagement02@gmail.com" style="color: #58a6ff;">royalmanagement02@gmail.com</a>
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDg6hedgJB7nK3xVvIrxg04ouFVTkIHe2k",
      authDomain: "mecktech-bbc2e.firebaseapp.com",
      databaseURL: "https://mecktech-bbc2e-default-rtdb.firebaseio.com",
      projectId: "mecktech-bbc2e",
      storageBucket: "mecktech-bbc2e.appspot.com",
      messagingSenderId: "790927325648",
      appId: "1:790927325648:web:9135f13e7dafba1f0b21d5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const storage = firebase.storage();

    function saveBranding() {
      const file = document.getElementById("logoFile").files[0];
      const name = document.getElementById("companyName").value;

      if (!file || !name) {
        alert("Please select a logo and enter a company name.");
        return;
      }

      const storageRef = storage.ref("logo/" + Date.now() + "_" + file.name);
      storageRef.put(file).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          db.ref("branding").set({ name, logo: url })
            .then(() => alert("Branding saved successfully!"))
            .catch(err => alert("Error saving branding: " + err.message));
        });
      }).catch(error => {
        alert("Error uploading logo: " + error.message);
      });
    }

    function setPrice() {
      const original = parseInt(document.getElementById("originalPrice").value);
      const discount = parseInt(document.getElementById("discountPrice").value);
      if (!original || !discount) return alert("Enter valid prices.");
      db.ref("price").set({ original, discount });
      alert("Price updated.");
    }

    function addQuestion() {
      const text = document.getElementById("questionText").value;
      const options = [
        document.getElementById("opt1").value,
        document.getElementById("opt2").value,
        document.getElementById("opt3").value,
        document.getElementById("opt4").value,
      ];
      const correct = parseInt(document.getElementById("correctOption").value);
      if (!text || options.some(opt => !opt) || isNaN(correct)) {
        return alert("Fill all fields correctly.");
      }
      const newQ = { text, options, correct };
      db.ref("questions").push(newQ);
      alert("Question added.");
      document.getElementById("questionText").value = "";
      document.getElementById("opt1").value = "";
      document.getElementById("opt2").value = "";
      document.getElementById("opt3").value = "";
      document.getElementById("opt4").value = "";
      document.getElementById("correctOption").value = "";
      renderQuestions();
    }

    function renderQuestions() {
      db.ref("questions").once("value", snap => {
        const data = snap.val();
        const list = document.getElementById("questionsList");
        list.innerHTML = "";
        if (!data) return;
        Object.keys(data).forEach(id => {
          const q = data[id];
          const div = document.createElement("div");
          div.className = "question";
          div.innerHTML = `
            <p><strong>${q.text}</strong></p>
            ${q.options.map((o, i) => `<p>${i + 1}. ${o}</p>`).join("")}
            <p>‚úÖ Correct: ${parseInt(q.correct) + 1}</p>
            <div class="actions">
              <button onclick="editQuestion('${id}', '${q.text.replace(/'/g, "\\'")}', ${JSON.stringify(q.options)}, ${q.correct})">‚úèÔ∏è Edit</button>
              <button onclick="deleteQuestion('${id}')">üóëÔ∏è Delete</button>
            </div>
          `;
          list.appendChild(div);
        });
      });
    }

    function deleteQuestion(id) {
      if (confirm("Delete this question?")) {
        db.ref("questions/" + id).remove().then(renderQuestions);
      }
    }

    function editQuestion(id, text, options, correct) {
      document.getElementById("questionText").value = text;
      document.getElementById("opt1").value = options[0];
      document.getElementById("opt2").value = options[1];
      document.getElementById("opt3").value = options[2];
      document.getElementById("opt4").value = options[3];
      document.getElementById("correctOption").value = correct;
      deleteQuestion(id);
    }

    function loadPaidUsers() {
      db.ref("paid_users").once("value", snap => {
        const data = snap.val();
        const list = document.getElementById("paidUsersList");
        list.innerHTML = "";
        if (!data) return (list.innerHTML = "No paid users yet.");
        Object.values(data).forEach(u => {
          const p = document.createElement("p");
          p.textContent = `${u.name} | ${u.email} | Score: ${u.score}`;
          list.appendChild(p);
        });
      });
    }

    renderQuestions();
    loadPaidUsers();
  </script>
</body>
</html>
