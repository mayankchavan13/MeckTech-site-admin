<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MeckTech Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #fff;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 2rem;
    }
    h1, h2 {
      text-align: center;
      color: #03dac5;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      background-color: #1e1e1e;
      border: none;
      border-radius: 5px;
      color: #fff;
      margin-top: 0.5rem;
    }
    button {
      padding: 10px 20px;
      background-color: #03dac5;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 1rem;
    }
    .section {
      margin-bottom: 3rem;
      padding: 1rem;
      background-color: #1e1e1e;
      border-radius: 10px;
    }
    .question-item {
      background: #2a2a2a;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 5px;
    }
    .question-actions {
      margin-top: 0.5rem;
    }
    .price-strike {
      text-decoration: line-through;
      color: #999;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MeckTech Admin Panel</h1>

    <div class="section">
      <h2>ðŸ”§ Company Branding</h2>
      <input type="text" id="companyName" placeholder="Enter Company Name" />
      <input type="file" id="logoInput" />
      <button onclick="saveBranding()">Save Branding</button>
    </div>

    <div class="section">
      <h2>ðŸ§  Add New Question</h2>
      <input type="text" id="q" placeholder="Enter question" />
      <input type="text" id="a" placeholder="Option A" />
      <input type="text" id="b" placeholder="Option B" />
      <input type="text" id="c" placeholder="Option C" />
      <input type="text" id="d" placeholder="Option D" />
      <input type="text" id="correct" placeholder="Correct Option (A/B/C/D)" />
      <button onclick="addQuestion()">Add Question</button>
    </div>

    <div class="section">
      <h2>ðŸ“œ Questions List</h2>
      <div id="questionsList"></div>
    </div>

    <div class="section">
      <h2>ðŸ’¸ Certificate Price</h2>
      <input type="number" id="price" placeholder="Enter Price (e.g. 149)" />
      <input type="number" id="discount" placeholder="Discounted Price (e.g. 99)" />
      <button onclick="savePrice()">Save Price</button>
    </div>

    <div class="section">
      <h2>ðŸ‘¥ Paid Users</h2>
      <ul id="paidUsersList"></ul>
    </div>
  </div>

<script>
const token = "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"; // ðŸ”‘ Your GitHub token here
const repo = "mayankchavan13/MeckTech-site-admin";

async function updateFile(filename, data) {
  const url = `https://api.github.com/repos/${repo}/contents/${filename}`;
  const getRes = await fetch(url, {
    headers: { Authorization: `token ${token}` }
  });
  const fileData = await getRes.json();
  const sha = fileData.sha;
  const content = btoa(JSON.stringify(data, null, 2));

  await fetch(url, {
    method: "PUT",
    headers: {
      Authorization: `token ${token}`,
      Accept: "application/vnd.github+json"
    },
    body: JSON.stringify({
      message: `Update ${filename}`,
      content,
      sha
    })
  });
}

// BRANDING
async function saveBranding() {
  const name = document.getElementById("companyName").value;
  const logoFile = document.getElementById("logoInput").files[0];
  if (!logoFile) return alert("Please select a logo");

  const reader = new FileReader();
  reader.onloadend = async function () {
    const logo = reader.result;
    const branding = { name, logo };
    await updateFile("branding.json", branding);
    alert("âœ… Branding updated");
  };
  reader.readAsDataURL(logoFile);
}

// QUESTIONS
let questions = [];

async function loadQuestions() {
  const res = await fetch(`https://raw.githubusercontent.com/${repo}/main/questions.json`);
  questions = await res.json();
  renderQuestions();
}

function renderQuestions() {
  const list = document.getElementById("questionsList");
  list.innerHTML = "";
  questions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question-item";
    div.innerHTML = `
      <b>Q${i + 1}: ${q.question}</b>
      <ul>
        ${q.options.map((opt, idx) => `<li>${String.fromCharCode(65 + idx)}. ${opt}</li>`).join("")}
      </ul>
      <small>Correct: ${q.correct}</small>
      <div class="question-actions">
        <button onclick="editQuestion(${i})">Edit</button>
        <button onclick="deleteQuestion(${i})">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function addQuestion() {
  const q = document.getElementById("q").value;
  const options = [
    document.getElementById("a").value,
    document.getElementById("b").value,
    document.getElementById("c").value,
    document.getElementById("d").value
  ];
  const correct = document.getElementById("correct").value.toUpperCase();

  if (!q || options.some(opt => !opt) || !["A","B","C","D"].includes(correct)) {
    alert("Please fill all fields correctly.");
    return;
  }

  questions.push({ question: q, options, correct });
  updateFile("questions.json", questions).then(() => {
    alert("âœ… Question added");
    loadQuestions();
    document.getElementById("q").value = "";
    document.getElementById("a").value = "";
    document.getElementById("b").value = "";
    document.getElementById("c").value = "";
    document.getElementById("d").value = "";
    document.getElementById("correct").value = "";
  });
}

function deleteQuestion(index) {
  if (!confirm("Delete this question?")) return;
  questions.splice(index, 1);
  updateFile("questions.json", questions).then(loadQuestions);
}

function editQuestion(index) {
  const q = questions[index];
  document.getElementById("q").value = q.question;
  document.getElementById("a").value = q.options[0];
  document.getElementById("b").value = q.options[1];
  document.getElementById("c").value = q.options[2];
  document.getElementById("d").value = q.options[3];
  document.getElementById("correct").value = q.correct;
  deleteQuestion(index);
}

// PRICE
async function savePrice() {
  const price = Number(document.getElementById("price").value);
  const discount = Number(document.getElementById("discount").value);
  await updateFile("price.json", { price, discount });
  alert("âœ… Price updated");
}

// USERS
async function loadUsers() {
  const res = await fetch(`https://raw.githubusercontent.com/${repo}/main/paid_users.json`);
  const users = await res.json();
  const ul = document.getElementById("paidUsersList");
  ul.innerHTML = "";
  users.forEach(u => {
    const li = document.createElement("li");
    li.innerText = `${u.name} | ${u.email} | Score: ${u.score}`;
    ul.appendChild(li);
  });
}

loadQuestions();
loadUsers();
</script>
</body>
</html>
